<!DOCTYPE html>
<html>

	<head>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.0rc1/angular-route.min.js"></script>
	
		<style>
		
		.book-content{
			display: inline-block;
			width: 300px;
		}
		.img-container{
			height: 450px;
		}
		
		.header{
			width: 100%;
			text-align: center;
		}
		
		.shelf{
			text-align: center;
			width: 100%;
		}
		</style>
		
		<script>
		
		</script>

	</head>

	<body ng-app="BookApp">
		<div class="header">
			<div class="container">
				<h1>A collection of timeless classics</h1>
			</div>
		</div>
		<div class="main">
			<div class="container shelf">
				<div ng-view class="book"></div>
			</div>
		</div>
		
		<!-- Angular section -->
		<script>
			var app = angular.module('BookApp', ['ngRoute']);
			
			app.config(['$routeProvider',function($routeProvider){
				$routeProvider.when('/',{
					controller: 'LibraryController',
					templateUrl: 'html/mybookapplibrary.html'
				}).when('/books/:id',{
					controller: 'BookController',
					templateUrl: 'html/mybookappbook.html'
				}).otherwise({
					redirectTo: '/'
				});		
			}]);
			
					
			//Return the all of the books display data in the library (e.g. title, picture location)
			app.controller('LibraryController',['$scope', 'librarydata', function($scope, librarydata){
				librarydata.success(function(data){
					$scope.library = data;
				}).error(function(data){
					$scope.library = data;
				});
			}]);
			
			//Get all of the current books in the library
			app.factory('librarydata',['$http', function($http){
				return $http.get('json/books.json').success(function(data){
					return data;
				}).error(function(data){
					return data;
				});
			}]);
			
			//Return the content of the current book
			app.controller('BookController',['$scope', 'bookdata', '$routeParams', function($scope, bookdata, $routeParams){
			
				//This is the current books ID
				$scope.bookID =$routeParams.id;
				$scope.$watch('bookID', function (newValue, oldValue) {
					if (newValue !== oldValue) {
						currentID.setID(newValue);
					}
				});
						
				bookdata.success(function(data){
					$scope.book = data;
				}).error(function(data){
					$scope.book = data;
				});
			}]);
							
			//Get the current book data
			app.factory('bookdata',['$http','$scope', function($http, $scope){
				
				$scope.$watch(function () { 
						return currentID.getID(); 
					},
					function (newValue, oldValue) {
						if (newValue !== oldValue) {
							$scope.bookID = newValue;
						}
				});
				
				return $http.get('json/book-' + $scope.bookID + '.json').success(function(data){
					return data;
				}).error(function(data){
					return data;
				});
			}]);	
			
			//Return or store the current books ID
			app.factory('currentID', function(){
				var bID = 0;
				
				return{
					getID: function(){
						return bID;
					},
					setID: function(newValue){
						bID = newValue;
					}
				};
			});
		</script>
	</body>

</html>